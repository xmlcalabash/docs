<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" class="no-js"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script><title>Chapter 5. Schematron assertions</title><link href="./css/pygments.css" rel="stylesheet"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link href="https://purl.org/dc/elements/1.1/" rel="schema.dc"/><meta name="dc.modified" content="2024-12-24T11:50:31Z"/><meta name="generator" content="DocBook xslTNG version 2.5.0 / 855db8f2 / SAXON HE 12.5"/><link href="./css/docbook-toc.css" rel="stylesheet"/><link href="./css/docbook.css" rel="stylesheet" media="screen"/><link href="img/icon.png" rel="shortcut icon"/><link href="./css/xmlcalabash.css" rel="stylesheet"/><link href="./css/xproc.css" rel="stylesheet"/><link rel="prev" href="debugging.html"/><link rel="next" href="configuration.html"/><link rel="up" href="index.html"/><link rel="home" href="index.html"/><script src="./js/persistent-toc.js" defer="defer"></script><script src="./js/copy-verbatim.js" defer="defer"></script><script src="./js/chunk-nav.js" defer="defer"></script></head><body class="chapter component"><nav class="top"><div><a href="index.html">Home</a> <a href="index.html">Up</a> <a href="configuration.html">Next</a> <a href="debugging.html">Prev</a></div></nav><main><section id="assertions" db-chunk="assertions.html" db-id="d110e1751" class="chapter component"><header><h2>Chapter <span class="label">5</span><span class="sep">. </span>Schematron assertions</h2></header><div class="db-bfs"><p>You can use Schematron assertions to test that your pipeline is processing
documents the way you expect. In order to use assertions you must enable them
with the <code class="option"><a href="running.html#cli-assertions">--assertions</a></code> option.
</p><p>There are two ways to use assertions: you can place them directly in
<code class="tag tag-element">p:input</code>, <code class="tag tag-element">p:output</code>, or <code class="tag tag-element">p:with-input</code> elements, or
you can refer to them with a <code class="tag tag-attribute">cx:assertions</code> extension
attribute.</p><p>In either case, each document is tested against the specified schema(s).</p></div><section id="assert-embed" class="section"><header><h2>Directly embedded assertions</h2></header><p>To use an assertion directly, simply place the Schematron schema in
a <code class="tag tag-element">p:pipeinfo</code> element in the input or output. For example:</p><div class="pre-wrap programlisting-wrap highlight" db-startinglinenumber="1" db-numberoflines="37"><pre class="language-xml long numbered programlisting verbatim verblines"><span class="line" db-line="1"><span class="ln"> 1 <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;p:declare-step</span> <span class="na">xmlns:p=</span><span class="s">"http://www.w3.org/ns/xproc"</span></code></span></span>
<span class="line" db-line="2"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>                <span class="na">xmlns:c=</span><span class="s">"http://www.w3.org/ns/xproc-step"</span></code></span></span>
<span class="line" db-line="3"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>                <span class="na">xmlns:cx=</span><span class="s">"http://xmlcalabash.com/ns/extensions"</span></code></span></span>
<span class="line" db-line="4"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>                <span class="na">xmlns:s=</span><span class="s">"http://purl.oclc.org/dsdl/schematron"</span></code></span></span>
<span class="line" db-line="5"><span class="ln"> 5 <span class="nsep">|</span></span><span class="ld"><code>                <span class="na">xmlns:xs=</span><span class="s">"http://www.w3.org/2001/XMLSchema"</span></code></span></span>
<span class="line" db-line="6"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>                <span class="na">exclude-inline-prefixes=</span><span class="s">"#all"</span> <span class="na">version=</span><span class="s">"3.0"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="7"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;p:input</span> <span class="na">port=</span><span class="s">"source"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="8"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;p:pipeinfo&gt;</span></code></span></span>
<span class="line" db-line="9"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="nt">&lt;s:schema</span> <span class="na">queryBinding=</span><span class="s">"xslt2"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="10"><span class="ln">10 <span class="nsep">|</span></span><span class="ld"><code>      <span class="nt">&lt;s:ns</span> <span class="na">prefix=</span><span class="s">"ex"</span> <span class="na">uri=</span><span class="s">"https://xmlcalabash.com/ns/examples"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line" db-line="11"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      <span class="nt">&lt;s:pattern&gt;</span></code></span></span>
<span class="line" db-line="12"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>        <span class="nt">&lt;s:rule</span> <span class="na">context=</span><span class="s">"/"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="13"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>          <span class="nt">&lt;s:report</span> <span class="na">test=</span><span class="s">"*/@xml:id"</span><span class="nt">&gt;</span>The source document has a root id.<span class="nt">&lt;/s:report&gt;</span></code></span></span>
<span class="line" db-line="14"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>          <span class="nt">&lt;s:report</span> <span class="na">test=</span><span class="s">"not(*/@xml:id)"</span><span class="nt">&gt;</span>The source document does not have a root id.<span class="nt">&lt;/s:report&gt;</span></code></span></span>
<span class="line" db-line="15"><span class="ln">15 <span class="nsep">|</span></span><span class="ld"><code>          <span class="nt">&lt;s:assert</span> <span class="na">test=</span><span class="s">"ex:book"</span><span class="nt">&gt;</span>The source is not a book.<span class="nt">&lt;/s:assert&gt;</span></code></span></span>
<span class="line" db-line="16"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>        <span class="nt">&lt;/s:rule&gt;</span></code></span></span>
<span class="line" db-line="17"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      <span class="nt">&lt;/s:pattern&gt;</span></code></span></span>
<span class="line" db-line="18"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="nt">&lt;/s:schema&gt;</span></code></span></span>
<span class="line" db-line="19"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;/p:pipeinfo&gt;</span></code></span></span>
<span class="line" db-line="20"><span class="ln">20 <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;/p:input&gt;</span></code></span></span>
<span class="line" db-line="21"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;p:output</span> <span class="na">port=</span><span class="s">"result"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="22"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;p:pipeinfo&gt;</span></code></span></span>
<span class="line" db-line="23"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="nt">&lt;s:schema</span> <span class="na">queryBinding=</span><span class="s">"xslt2"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="24"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      <span class="nt">&lt;s:pattern&gt;</span></code></span></span>
<span class="line" db-line="25"><span class="ln">25 <span class="nsep">|</span></span><span class="ld"><code>        <span class="nt">&lt;s:rule</span> <span class="na">context=</span><span class="s">"/"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="26"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>          <span class="nt">&lt;s:assert</span> <span class="na">test=</span><span class="s">"string(/*/@unique-id) != ''"</span><span class="nt">&gt;</span>The output does not have a unique id.<span class="nt">&lt;/s:assert&gt;</span></code></span></span>
<span class="line" db-line="27"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>        <span class="nt">&lt;/s:rule&gt;</span></code></span></span>
<span class="line" db-line="28"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      <span class="nt">&lt;/s:pattern&gt;</span></code></span></span>
<span class="line" db-line="29"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="nt">&lt;/s:schema&gt;</span></code></span></span>
<span class="line" db-line="30"><span class="ln">30 <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;/p:pipeinfo&gt;</span></code></span></span>
<span class="line" db-line="31"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;/p:output&gt;</span></code></span></span>
<span class="line" db-line="32"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="33"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;p:add-attribute</span> <span class="na">attribute-name=</span><span class="s">"unique-id"</span> <span class="na">attribute-value=</span><span class="s">""</span><span class="nt">/&gt;</span></code></span></span>
<span class="line" db-line="34"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="35"><span class="ln">35 <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;p:uuid</span> <span class="na">match=</span><span class="s">"/*/@unique-id"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line" db-line="36"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="37"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;/p:declare-step&gt;</span></code></span></span></pre></div><p>If you enable assertion warnings and run that pipeline with this input document:</p><div class="pre-wrap programlisting-wrap highlight" db-startinglinenumber="1" db-numberoflines="4"><pre class="language-xml numbered programlisting verbatim verblines"><span class="line" db-line="1"><span class="ln">  <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;chap</span> <span class="na">xmlns=</span><span class="s">"https://xmlcalabash.com/ns/examples"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="2"><span class="ln">  <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;title&gt;</span>Second Chapter<span class="nt">&lt;/title&gt;</span></code></span></span>
<span class="line" db-line="3"><span class="ln">  <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;p&gt;</span>…<span class="nt">&lt;/p&gt;</span></code></span></span>
<span class="line" db-line="4"><span class="ln">  <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;/chap&gt;</span></code></span></span></pre></div><p>You’ll see:</p><div class="pre-wrap screen-wrap"><pre class="screen verbatim verblines"><span class="line"><span class="ld"><code><span class="prompt">&gt; </span><span class="userinput">xmlcalabash --assertions:warn -i:source=default-ch2.xml</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">At / on p:declare-step/source in file:/…/examples/xml/default-ch2.xml:</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">  Report not(*/@xml:id): The source document does not have a root id.</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">At / on p:declare-step/source in file:/…/examples/xml/default-ch2.xml:</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">  Warning ex:book: The source is not a book.</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">=== result :: 1 :: file:/…/examples/xml/default-ch2.xml ===</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">&lt;chap xmlns="https://xmlcalabash.com/ns/examples"</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">      unique-id="16e550c1-96ff-4e88-98be-d85a15183a65"&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">   &lt;title&gt;Second Chapter&lt;/title&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">   &lt;p&gt;…&lt;/p&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">&lt;/chap&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">=====================================================================================================</span></code></span></span></pre></div><p>If you enable assertion errors, the pipeline will fail. If you ignore assertions,
you’ll just get the output without any schema results.</p></section><section id="assert-ref" class="section"><header><h2>Assertions by reference</h2></header><p>There are two reasons to use assertions by reference: reuse and testing
the output of atomic steps:</p><ul class="itemizedlist"><li><p>It may be convenient to make the same assertions on
several outputs, so it’s useful to refer to a schema rather than embedding it
directly every time.</p></li><li><p>Atomic steps don’t have <code class="tag tag-element">p:output</code> (or any sort of “with-output”)
children in which you can place the assertions, so there has to be another method
to reference them.</p></li></ul><p>To use them by reference, place the schemas in a <code class="tag tag-element">p:pipeinfo</code> within the
<code class="tag tag-element">p:declare-step</code> (or <code class="tag tag-element">p:library</code>) that contains the pipeline. Give
each schema an <code class="tag tag-attribute">xml:id</code> attribute.</p><p>You can refer to the schemas from a <code class="tag tag-attribute">cx:assertions</code>
attribute on a step. The attribute is a map from port names to a list of IDs.
Here is the earlier assertions pipeline rewritten in this way:</p><div class="pre-wrap programlisting-wrap highlight" db-startinglinenumber="1" db-numberoflines="39"><pre class="language-xml long numbered programlisting verbatim verblines"><span class="line" db-line="1"><span class="ln"> 1 <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;p:declare-step</span> <span class="na">xmlns:p=</span><span class="s">"http://www.w3.org/ns/xproc"</span></code></span></span>
<span class="line" db-line="2"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>                <span class="na">xmlns:c=</span><span class="s">"http://www.w3.org/ns/xproc-step"</span></code></span></span>
<span class="line" db-line="3"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>                <span class="na">xmlns:cx=</span><span class="s">"http://xmlcalabash.com/ns/extensions"</span></code></span></span>
<span class="line" db-line="4"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>                <span class="na">xmlns:s=</span><span class="s">"http://purl.oclc.org/dsdl/schematron"</span></code></span></span>
<span class="line" db-line="5"><span class="ln"> 5 <span class="nsep">|</span></span><span class="ld"><code>                <span class="na">xmlns:xs=</span><span class="s">"http://www.w3.org/2001/XMLSchema"</span></code></span></span>
<span class="line" db-line="6"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>                <span class="na">exclude-inline-prefixes=</span><span class="s">"#all"</span> <span class="na">version=</span><span class="s">"3.0"</span></code></span></span>
<span class="line" db-line="7"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="na">cx:assertions=</span><span class="s">"map { 'source': ('assert-input') }"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="8"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;p:input</span> <span class="na">port=</span><span class="s">"source"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line" db-line="9"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;p:output</span> <span class="na">port=</span><span class="s">"result"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line" db-line="10"><span class="ln">10 <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="11"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;p:add-attribute</span> <span class="na">attribute-name=</span><span class="s">"unique-id"</span> <span class="na">attribute-value=</span><span class="s">""</span><span class="nt">/&gt;</span></code></span></span>
<span class="line" db-line="12"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="13"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;p:uuid</span> <span class="na">match=</span><span class="s">"/*/@unique-id"</span></code></span></span>
<span class="line" db-line="14"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>        <span class="na">cx:assertions=</span><span class="s">"map { 'result': 'assert-output' }"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line" db-line="15"><span class="ln">15 <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="16"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="cm">&lt;!-- ============================================================ --&gt;</span></code></span></span>
<span class="line" db-line="17"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="18"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;p:pipeinfo&gt;</span></code></span></span>
<span class="line" db-line="19"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;s:schema</span> <span class="na">queryBinding=</span><span class="s">"xslt2"</span> <span class="na">xml:id=</span><span class="s">"assert-input"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="20"><span class="ln">20 <span class="nsep">|</span></span><span class="ld"><code>    <span class="nt">&lt;s:ns</span> <span class="na">prefix=</span><span class="s">"ex"</span> <span class="na">uri=</span><span class="s">"https://xmlcalabash.com/ns/examples"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line" db-line="21"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="nt">&lt;s:pattern&gt;</span></code></span></span>
<span class="line" db-line="22"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      <span class="nt">&lt;s:rule</span> <span class="na">context=</span><span class="s">"/"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="23"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>        <span class="nt">&lt;s:report</span> <span class="na">test=</span><span class="s">"*/@xml:id"</span><span class="nt">&gt;</span>The source document has a root id.<span class="nt">&lt;/s:report&gt;</span></code></span></span>
<span class="line" db-line="24"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>        <span class="nt">&lt;s:report</span> <span class="na">test=</span><span class="s">"not(*/@xml:id)"</span><span class="nt">&gt;</span>The source document does not have a root id.<span class="nt">&lt;/s:report&gt;</span></code></span></span>
<span class="line" db-line="25"><span class="ln">25 <span class="nsep">|</span></span><span class="ld"><code>        <span class="nt">&lt;s:assert</span> <span class="na">test=</span><span class="s">"ex:book"</span><span class="nt">&gt;</span>The source is not a book.<span class="nt">&lt;/s:assert&gt;</span></code></span></span>
<span class="line" db-line="26"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      <span class="nt">&lt;/s:rule&gt;</span></code></span></span>
<span class="line" db-line="27"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="nt">&lt;/s:pattern&gt;</span></code></span></span>
<span class="line" db-line="28"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;/s:schema&gt;</span></code></span></span>
<span class="line" db-line="29"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="30"><span class="ln">30 <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;s:schema</span> <span class="na">queryBinding=</span><span class="s">"xslt2"</span> <span class="na">xml:id=</span><span class="s">"assert-output"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="31"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="nt">&lt;s:pattern&gt;</span></code></span></span>
<span class="line" db-line="32"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      <span class="nt">&lt;s:rule</span> <span class="na">context=</span><span class="s">"/"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="33"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>        <span class="nt">&lt;s:assert</span> <span class="na">test=</span><span class="s">"string(/*/@unique-id) != ''"</span><span class="nt">&gt;</span>The output does not have a unique id.<span class="nt">&lt;/s:assert&gt;</span></code></span></span>
<span class="line" db-line="34"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      <span class="nt">&lt;/s:rule&gt;</span></code></span></span>
<span class="line" db-line="35"><span class="ln">35 <span class="nsep">|</span></span><span class="ld"><code>    <span class="nt">&lt;/s:pattern&gt;</span></code></span></span>
<span class="line" db-line="36"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;/s:schema&gt;</span></code></span></span>
<span class="line" db-line="37"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;/p:pipeinfo&gt;</span></code></span></span>
<span class="line" db-line="38"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="39"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;/p:declare-step&gt;</span></code></span></span></pre></div><p>As a convience for the case where you want to reuse schemas where
you have an input or output element, you can put the 
<code class="tag tag-attribute">cx:assertions</code> attribute directly on the input or
output element. In this case, the assertions must be a list of strings.</p><p>Here’s a final example that adds another test.</p><div class="pre-wrap programlisting-wrap highlight" db-startinglinenumber="1" db-numberoflines="48"><pre class="language-xml long numbered programlisting verbatim verblines"><span class="line" db-line="1"><span class="ln"> 1 <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;p:declare-step</span> <span class="na">xmlns:p=</span><span class="s">"http://www.w3.org/ns/xproc"</span></code></span></span>
<span class="line" db-line="2"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>                <span class="na">xmlns:c=</span><span class="s">"http://www.w3.org/ns/xproc-step"</span></code></span></span>
<span class="line" db-line="3"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>                <span class="na">xmlns:cx=</span><span class="s">"http://xmlcalabash.com/ns/extensions"</span></code></span></span>
<span class="line" db-line="4"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>                <span class="na">xmlns:s=</span><span class="s">"http://purl.oclc.org/dsdl/schematron"</span></code></span></span>
<span class="line" db-line="5"><span class="ln"> 5 <span class="nsep">|</span></span><span class="ld"><code>                <span class="na">xmlns:xs=</span><span class="s">"http://www.w3.org/2001/XMLSchema"</span></code></span></span>
<span class="line" db-line="6"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>                <span class="na">exclude-inline-prefixes=</span><span class="s">"#all"</span> <span class="na">version=</span><span class="s">"3.0"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="7"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;p:input</span> <span class="na">port=</span><span class="s">"source"</span> <span class="na">cx:assertions=</span><span class="s">"'assert-input'"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line" db-line="8"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;p:output</span> <span class="na">port=</span><span class="s">"result"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line" db-line="9"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="10"><span class="ln">10 <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;p:add-attribute</span> <span class="na">attribute-name=</span><span class="s">"unique-id"</span> <span class="na">attribute-value=</span><span class="s">""</span><span class="nt">/&gt;</span></code></span></span>
<span class="line" db-line="11"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="12"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;p:uuid</span> <span class="na">match=</span><span class="s">"/*/@unique-id"</span></code></span></span>
<span class="line" db-line="13"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>        <span class="na">cx:assertions=</span><span class="s">"map { 'result': 'assert-output' }"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="14"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;p:with-input</span> <span class="na">cx:assertions=</span><span class="s">"'assert-attribute'"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line" db-line="15"><span class="ln">15 <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;/p:uuid&gt;</span></code></span></span>
<span class="line" db-line="16"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="17"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="cm">&lt;!-- ============================================================ --&gt;</span></code></span></span>
<span class="line" db-line="18"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="19"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;p:pipeinfo&gt;</span></code></span></span>
<span class="line" db-line="20"><span class="ln">20 <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;s:schema</span> <span class="na">queryBinding=</span><span class="s">"xslt2"</span> <span class="na">xml:id=</span><span class="s">"assert-input"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="21"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="nt">&lt;s:ns</span> <span class="na">prefix=</span><span class="s">"ex"</span> <span class="na">uri=</span><span class="s">"https://xmlcalabash.com/ns/examples"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line" db-line="22"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="nt">&lt;s:pattern&gt;</span></code></span></span>
<span class="line" db-line="23"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      <span class="nt">&lt;s:rule</span> <span class="na">context=</span><span class="s">"/"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="24"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>        <span class="nt">&lt;s:report</span> <span class="na">test=</span><span class="s">"*/@xml:id"</span><span class="nt">&gt;</span>The source document has a root id.<span class="nt">&lt;/s:report&gt;</span></code></span></span>
<span class="line" db-line="25"><span class="ln">25 <span class="nsep">|</span></span><span class="ld"><code>        <span class="nt">&lt;s:report</span> <span class="na">test=</span><span class="s">"not(*/@xml:id)"</span><span class="nt">&gt;</span>The source document does not have a root id.<span class="nt">&lt;/s:report&gt;</span></code></span></span>
<span class="line" db-line="26"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>        <span class="nt">&lt;s:assert</span> <span class="na">test=</span><span class="s">"ex:book"</span><span class="nt">&gt;</span>The source is not a book.<span class="nt">&lt;/s:assert&gt;</span></code></span></span>
<span class="line" db-line="27"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      <span class="nt">&lt;/s:rule&gt;</span></code></span></span>
<span class="line" db-line="28"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="nt">&lt;/s:pattern&gt;</span></code></span></span>
<span class="line" db-line="29"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;/s:schema&gt;</span></code></span></span>
<span class="line" db-line="30"><span class="ln">30 <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="31"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;s:schema</span> <span class="na">queryBinding=</span><span class="s">"xslt2"</span> <span class="na">xml:id=</span><span class="s">"assert-output"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="32"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="nt">&lt;s:pattern&gt;</span></code></span></span>
<span class="line" db-line="33"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      <span class="nt">&lt;s:rule</span> <span class="na">context=</span><span class="s">"/"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="34"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>        <span class="nt">&lt;s:assert</span> <span class="na">test=</span><span class="s">"string(/*/@unique-id) != ''"</span><span class="nt">&gt;</span>The output does not have a unique id.<span class="nt">&lt;/s:assert&gt;</span></code></span></span>
<span class="line" db-line="35"><span class="ln">35 <span class="nsep">|</span></span><span class="ld"><code>      <span class="nt">&lt;/s:rule&gt;</span></code></span></span>
<span class="line" db-line="36"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="nt">&lt;/s:pattern&gt;</span></code></span></span>
<span class="line" db-line="37"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;/s:schema&gt;</span></code></span></span>
<span class="line" db-line="38"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="39"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;s:schema</span> <span class="na">queryBinding=</span><span class="s">"xslt2"</span> <span class="na">xml:id=</span><span class="s">"assert-attribute"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="40"><span class="ln">40 <span class="nsep">|</span></span><span class="ld"><code>    <span class="nt">&lt;s:pattern&gt;</span></code></span></span>
<span class="line" db-line="41"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      <span class="nt">&lt;s:rule</span> <span class="na">context=</span><span class="s">"/"</span><span class="nt">&gt;</span></code></span></span>
<span class="line" db-line="42"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>        <span class="nt">&lt;s:assert</span> <span class="na">test=</span><span class="s">"*/@unique-id"</span><span class="nt">&gt;</span>The input does not have a unique-id attribute.<span class="nt">&lt;/s:assert&gt;</span></code></span></span>
<span class="line" db-line="43"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      <span class="nt">&lt;/s:rule&gt;</span></code></span></span>
<span class="line" db-line="44"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>    <span class="nt">&lt;/s:pattern&gt;</span></code></span></span>
<span class="line" db-line="45"><span class="ln">45 <span class="nsep">|</span></span><span class="ld"><code>  <span class="nt">&lt;/s:schema&gt;</span></code></span></span>
<span class="line" db-line="46"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;/p:pipeinfo&gt;</span></code></span></span>
<span class="line" db-line="47"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="48"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><span class="nt">&lt;/p:declare-step&gt;</span></code></span></span></pre></div><p>You can mix-and-match the embedded and referenced assertions.</p></section></section></main><nav class="bottom"><table><tr><td class="previous"><a href="debugging.html">Prev</a></td><td class="up"><a href="index.html">Up</a></td><td class="next"><a href="configuration.html">Next</a></td></tr><tr><td class="previous">Chapter <span class="label">4</span><span class="sep">. </span>The interactive debugger</td><td class="up"><a href="index.html">Home</a></td><td class="next">Appendix <span class="label">A</span><span class="sep">. </span>Configuration</td></tr></table><nav class="tocopen"></nav><nav class="toc"></nav><!-- Hide ToC details from user agents that don’t support JS --><script type="text/html" class="tocopen"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAABDklEQVQ4je2UUW3EMAyGv0wDUAhlkDBIyuAYXCEclEJoGZRBUgYOgzJoGHgPW6o7rWq35+2TIkWW9duW7N+oKuM46jiOGGMAaNsW5xzee5xzn8EvRESXZUFEWNcVAFWl73v6vjcGUIAYIyEEANZ1RUSY55lSCo/HA4BhGGiahtvthnOOtm0BSCnRdd1eVAGNMeoR27aptVattbpt22FOjFGrzjsX1I7q/4q3y4xf8i/4FwT3Pcw5Y4zBWvujfQMopZBzJuf8XbCeVyWEgHOO+/2+x0SEaZpIKSEih0X2Wz6jdlxKuezaqL7qpZS0lLKbw/M4ANba3RyapiGE8OJGqOrpizGq916999VATvM/AGFn1sxsVjL5AAAAAElFTkSuQmCC" alt="[toc]"/></script><script type="text/html" class="toc"><header><span>Table of Contents</span><span class="close"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAtklEQVQ4jaWT0Q3DIAxEz52AEbyB2cDZhBEY3SNcPyqqBEwqpZaQAHNP5jBCEiJCPAiSIgAeiUe8zoveO9x9e9jd0XtfKwHA1hpHtNY49rO8u59zn4mqMiJSyFkcEVTVFQCAtdYFMotrrXN111JnyA/xCsggN2JeXmGEmaGU8l2XUmBm29fZuh0RW2PTK2SGZcamADPb3nmGmNkKOI7j1rAzJG2kcWhqkstQ1QX+/2ciKU/FJOUN6JFZYWpmK3sAAAAASUVORK5CYII=" alt="X"/></span><p class="ptoc-search"><input class="ptoc-search" placeholder="Search" style="width: 80%"/></p></header><div db-persistent-toc="persistent-toc.html" db-prefix="">Loading…</div></script></nav></body></html>