<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" class="no-js"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script><title>Chapter 4. The interactive debugger</title><link href="./css/pygments.css" rel="stylesheet"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link href="https://purl.org/dc/elements/1.1/" rel="schema.dc"/><meta name="dc.modified" content="2024-12-28T16:25:20Z"/><meta name="generator" content="DocBook xslTNG version 2.5.0 / 855db8f2 / SAXON HE 12.5"/><link href="./css/docbook-toc.css" rel="stylesheet"/><link href="./css/docbook.css" rel="stylesheet" media="screen"/><link href="img/icon.png" rel="shortcut icon"/><link href="./css/xmlcalabash.css" rel="stylesheet"/><link href="./css/xproc.css" rel="stylesheet"/><link rel="prev" href="graphs.html"/><link rel="next" href="assertions.html"/><link rel="up" href="index.html"/><link rel="home" href="index.html"/><script src="./js/persistent-toc.js" defer="defer"></script><script src="./js/copy-verbatim.js" defer="defer"></script><script src="./js/chunk-nav.js" defer="defer"></script></head><body class="chapter component"><nav class="top"><div><a href="index.html">Home</a> <a href="index.html">Up</a> <a href="assertions.html">Next</a> <a href="graphs.html">Prev</a></div></nav><main><section id="debugging" db-chunk="debugging.html" db-id="d112e942" class="chapter component"><header><h2>Chapter <span class="label">4</span><span class="sep">. </span>The interactive debugger</h2></header><div class="db-bfs"><p>If you run XML Calabash with the <code class="option"><a href="running.html#cli-debugger">--debugger</a></code> option, the pipeline is loaded
and then the debugger starts.</p><div class="admonition note"><div><div class="icon">ⓘ</div><div class="body"><header><div class="title">Note</div></header><div><p>This is a very new feature and there are a number of rough edges. There
are discrepancies between atomic and compound steps that don’t really make
any sense. The command line interpreter doesn’t have history or completion.
Future releases will (hopefully) sand off some of the sharper
edges!</p></div></div></div></div><p>The debugger prompt is <code>&gt; </code>. When you start a pipeline in the
debugger, the first prompt occurs just before the initial pipeline begins running.
Subsequent prompts occur when you step through the running pipeline or when breakpoints
are encountered.</p><p>The debugger is always operating in the context of a particular step. There
may be a stack of open steps. Moving around in the stack changes the context.</p></div><section id="debugging_s1" class="section"><header><h2>Command summary</h2></header><p>The available commands are:</p><ul class="itemizedlist"><li><p class="simpara"><code class="command"><a href="#dbg-base-uri">base-uri</a></code>, set or display the base URI.</p></li><li><p class="simpara"><code class="command"><a href="#dbg-breakpoint">breakpoint</a></code>, set or display breakpoints.</p></li><li><p class="simpara"><code class="command"><a href="#dbg-catch">catch</a></code>, catch errors.</p></li><li><p class="simpara"><code class="command"><a href="#dbg-define">define</a></code>, define a local variable.</p></li><li><p class="simpara"><code class="command"><a href="#dbg-down">down</a></code>, move down the stack.</p></li><li><p class="simpara"><code class="command"><a href="#dbg-exit">exit</a></code>, exit the debugger and terminate the pipeline.</p></li><li><p class="simpara"><code class="command"><a href="#dbg-help">help</a></code>, get help.</p></li><li><p class="simpara"><code class="command"><a href="#dbg-inputs">inputs</a></code>, show step inputs.</p></li><li><p class="simpara"><code class="command"><a href="#dbg-models">models</a></code>, show the pipeline models.</p></li><li><p class="simpara"><code class="command"><a href="#dbg-namespace">namespace</a></code>, set or display namespace bindings.</p></li><li><p class="simpara"><code class="command"><a href="#dbg-options">options</a></code>, show step options and local variables.</p></li><li><p class="simpara"><code class="command"><a href="#dbg-run">run</a></code>, continue running the pipeline.</p></li><li><p class="simpara"><code class="command"><a href="#dbg-set">set</a></code>, set the value of an option or local variable.</p></li><li><p class="simpara"><code class="command"><a href="#dbg-show">show</a></code>, show the result of evaluating an expression.</p></li><li><p class="simpara"><code class="command"><a href="#dbg-stack"></a></code>, show the stack.</p></li><li><p class="simpara"><code class="command"><a href="#dbg-step"></a></code>, run the current step.</p></li><li><p class="simpara"><code class="command"><a href="#dbg-subpipeline">subpipeline</a></code>, show the subpipeline steps.</p></li><li><p class="simpara"><code class="command"><a href="#dbg-up">up</a></code>, move up the stack.</p></li></ul><section id="dbg-base-uri" class="section"><header><h3>base-uri</h3></header><p>Set or display the value of the base URI.</p><div class="cmdsynopsis-wrap"><div class="cmdsynopsis"><span class="command">base-uri</span> <span class="cmdpunct">[</span><span class="arg">"<em class="replaceable">uri</em>"</span><span class="cmdpunct">]</span></div></div><p>If no <em class="replaceable">uri</em> is specified, shows the current base URI.
If a URI is provided, the base URI is changed to <em class="replaceable">uri</em>.
(The URI can be delimited with single or double quotes.)
</p><p>Setting the base URI is temporary; it is reset to the base URI of the context
step whenever a step is run.</p><p>The command <code class="command">base</code> is a
synonym for <code class="command">base-uri</code>.</p></section><section id="dbg-breakpoint" class="section"><header><h3>breakpoint</h3></header><p>Set or display breakpoints.</p><p>There are five forms of the <code class="command">breakpoint</code> command:
</p><div class="cmdsynopsis-wrap"><div class="cmdsynopsis"><span class="command">breakpoint</span></div></div><p>If used with no arguments, the <code class="command">breakpoint</code> command prints a summary
of enabled breakpoints.</p><div class="cmdsynopsis-wrap"><div class="cmdsynopsis"><span class="command">breakpoint</span> <span class="arg">on</span> <span class="arg"><em class="replaceable">id</em></span> <span class="cmdpunct">[</span><span class="arg">
     <span class="arg">when</span>
     <span class="arg"><em class="replaceable">expression</em></span>
  </span><span class="cmdpunct">]</span></div></div><p>Sets a breakpoint before the step <em class="replaceable">id</em> is
executed. If an XPath <em class="replaceable">expression</em> is provided,
the breakpoint is conditional on that expression. The breakpoint only
occurs if the effective boolean value of the expression is true.</p><div class="cmdsynopsis-wrap"><div class="cmdsynopsis"><span class="command">breakpoint</span> <span class="arg">on</span> <span class="arg"><em class="replaceable">id</em></span> <span class="cmdpunct">[</span><span class="arg">
     <span class="cmdpunct">[</span><span class="arg">at</span><span class="cmdpunct">]</span>
     <span class="arg">input</span>
     <span class="arg"><em class="replaceable">port</em></span>
  </span><span class="cmdpunct">]</span> <span class="cmdpunct">[</span><span class="arg">
     <span class="arg">when</span>
     <span class="arg"><em class="replaceable">expression</em></span>
  </span><span class="cmdpunct">]</span></div></div><p>Sets a breakpoint before the step <em class="replaceable">id</em> is
executed. This breakpoint is conditional on input arriving on
<em class="replaceable">port</em>.
If an XPath <em class="replaceable">expression</em> is provided,
it will be evaluated once for each input on the specified <em class="replaceable">port</em>,
with the input as the context item. The breakpoint only
occurs if the effective boolean value of at least one expression is true.</p><p>Unlike breakpoints on output ports, the breakpoint occurs just before
the step executes. An “input” breakpoint is just a special kind of conditional
breakpoint.</p><div class="cmdsynopsis-wrap"><div class="cmdsynopsis"><span class="command">breakpoint</span> <span class="arg">on</span> <span class="arg"><em class="replaceable">id</em></span> <span class="cmdpunct">[</span><span class="arg">
     <span class="cmdpunct">[</span><span class="arg">at</span><span class="cmdpunct">]</span>
     <span class="arg">output</span>
     <span class="arg"><em class="replaceable">port</em></span>
  </span><span class="cmdpunct">]</span> <span class="cmdpunct">[</span><span class="arg">
     <span class="arg">when</span>
     <span class="arg"><em class="replaceable">expression</em></span>
  </span><span class="cmdpunct">]</span></div></div><p>Sets a breakpoint that occurs when the step <em class="replaceable">id</em>
produces a document on its output port named <em class="replaceable">port</em>.
If an XPath <em class="replaceable">expression</em> is provided,
it will be evaluated with the document as the context item. The breakpoint only
occurs if the effective boolean value of the expression is true.</p><p>When this breakpoint occurs, a variable named <code class="literal">cx:document</code>
is added to the local variables. If the value of this variable is changed,
the document that’s actually sent as output will be changed accordingly.</p><p>Finally,</p><div class="cmdsynopsis-wrap"><div class="cmdsynopsis"><span class="command">breakpoint</span> <span class="arg">clear</span> <span class="arg"><em class="replaceable">id</em></span></div></div><p>Will clear a breakpoint.</p><p>The commands <code class="command">break</code> and <code class="command">b</code> are
synonyms for <code class="command">breakpoint</code> and <code class="command">set</code>
is a synonym for <code class="command">on</code>.</p></section><section id="dbg-catch" class="section"><header><h3>catch</h3></header><p>Catch errors.</p><div class="cmdsynopsis-wrap"><div class="cmdsynopsis"><span class="command">catch</span> <span class="cmdpunct">[</span><span class="arg">
     <span class="arg">on</span>
     <span class="arg"><em class="replaceable">id</em></span>
  </span><span class="cmdpunct">]</span> <span class="cmdpunct">[</span><span class="arg">
     <span class="arg">error</span>
     <span class="arg"><em class="replaceable">code</em></span>
  </span><span class="cmdpunct">]</span></div></div><p>If used with no arguments, the <code class="command">catch</code> command prints a
summary of existing catch points.</p><p>If an <em class="replaceable">id</em> is provided, the debugger will catch
errors on the step <em class="replaceable">id</em>. If a
<em class="replaceable">code</em> is provided, the debugger will only stop if the
error code matches <em class="replaceable">code</em>. If only a
<em class="replaceable">code</em> is provided, the debugger will stop at any step
when that error occurs. Errors precolate up the stack until a <code class="tag tag-element">p:try</code>
is encountered or the pipeline terminates. It is possible to catch the same
error on several consecutive steps as you go “up” the stack.</p><p>If a <em class="replaceable">code</em> is provided, it is interpreted as a QName
in the context of the step(s) on which it is being evaluated. It must be a valid
QName in the context in order to match.</p><p>When an error is caught, the last stack frame is the step that has been aborted.
You can inspect its options and inputs, but it has already run, so changing them can
have no effect.</p></section><section id="dbg-define" class="section"><header><h3>define</h3></header><p>Define a local variable.</p><div class="cmdsynopsis-wrap"><div class="cmdsynopsis"><span class="command">define</span> <span class="arg">$<em class="replaceable">varname</em></span> <span class="arg">=</span> <span class="arg"><em class="replaceable">expression</em></span></div></div><p>Creates a local variable named <code class="varname">$varname</code> and assigns to it
the value that results from evaluating the expression. (If an error occurs
evaluating the expression, the empty sequence will be assigned.)</p><p>You can only define variables that do not already exist. To change the
value of an existing variable, use <a href="#dbg-set" class="link">set</a>.</p><p>Local variables shadow step options of the same name.</p><p>The command <code class="command">def</code> is a synonym for
<code class="command">define</code>.</p></section><section id="dbg-down" class="section"><header><h3>down</h3></header><p>Move down in the stack.</p><div class="cmdsynopsis-wrap"><div class="cmdsynopsis"><span class="command">down</span> <span class="cmdpunct">[</span><span class="arg"><em class="replaceable">frames</em></span><span class="cmdpunct">]</span></div></div><p>Moves down <em class="replaceable">frames</em> stack frames, or one frame if
<em class="replaceable">frames</em> is not specified. Has no effect if you’re
already on the last frame.</p><p>The command <code class="command">d</code> is a synonym for
<code class="command">down</code>.</p></section><section id="dbg-exit" class="section"><header><h3>exit</h3></header><p>Exit the debugger and the pipeline.</p><div class="cmdsynopsis-wrap"><div class="cmdsynopsis"><span class="command">exit</span></div></div><p>Quits the debugger and aborts execution of the pipeline.</p><p>The commands <code class="command">x</code>, <code class="command">quit</code>,
and <code class="command">q</code> are
synonyms for <code class="command">exit</code>.</p></section><section id="dbg-help" class="section"><header><h3>help</h3></header><p>Get help.</p><div class="cmdsynopsis-wrap"><div class="cmdsynopsis"><span class="command">help</span> <span class="cmdpunct">[</span><span class="arg"><em class="replaceable">command</em></span><span class="cmdpunct">]</span></div></div><p>Displays a summary of the debugger commands. If <em class="replaceable">command</em> is
provided, more detail is given about that command.</p><p>The commands <code class="command">h</code> and <code class="command">?</code> are
synonyms for <code class="command">help</code>.</p></section><section id="dbg-inputs" class="section"><header><h3>inputs</h3></header><p>Show the step inputs.</p><div class="cmdsynopsis-wrap"><div class="cmdsynopsis"><span class="command">inputs</span></div></div><p>Displays a summary of the inputs provided to the step. These can be
examined in more detail with the <code class="varname">cx:input</code> map.</p><p>The command <code class="command">i</code> is a
synonym for <code class="command">inputs</code>.</p></section><section id="dbg-models" class="section"><header><h3>models</h3></header><p>Show the pipeline models.</p><div class="cmdsynopsis-wrap"><div class="cmdsynopsis"><span class="command">models</span> <span class="cmdpunct">[</span><span class="arg"><em class="replaceable">model</em></span><span class="cmdpunct">]</span></div></div><p>In order to execute a pipeline, XML Calabash transforms it into a graph model.
These models are then instantiated to be executed. The <code class="command">model</code> command
allows you to explore the available models.</p><p>(At the moment, the mapping from model identifiers to the identifiers used during
pipeline execution is unpredictable. Hopefully, that will be resolved in the future,
allowing you to predict a step id for use in a breakpoint directly from the model.)</p><p>The commands <code class="command">mod</code> and <code class="command">m</code> are
synonyms for <code class="command">model</code>.</p></section><section id="dbg-namespace" class="section"><header><h3>namespace</h3></header><p>Set or display namespace bindings.</p><div class="cmdsynopsis-wrap"><div class="cmdsynopsis"><span class="command">namespace</span> <span class="cmdpunct">[</span><span class="arg">
   <span class="arg"><em class="replaceable">prefix</em></span>
   <span class="arg">=</span>
   <span class="arg">"<em class="replaceable">uri</em>"</span>
</span><span class="cmdpunct">]</span></div></div><p>Assigns the URI <em class="replaceable">uri</em> to the namespace prefix
<em class="replaceable">prefix</em> in the local namespace bindings. For the
purpose of evaluating expressions, local namespace bindings shadow bindings
from the step context.</p><p>If entered with no binding, <code class="command">namespace</code> prints the current
bindings.</p><p>The command <code class="command">ns</code> is a
synonym for <code class="command">namespace</code>.</p></section><section id="dbg-options" class="section"><header><h3>options</h3></header><p>Display (atomic) step options and local variables.</p><div class="cmdsynopsis-wrap"><div class="cmdsynopsis"><span class="command">options</span></div></div><p>Displays the names of any options defined on the current (atomic) step
or in local variables. These names can be used in expressions. Changing the value
of a step option changes the value the step will receive when it runs!</p><p>The commands <code class="command">o</code>, <code class="command">variables</code>
and <code class="command">var</code> are
synonyms for <code class="command">options</code>.</p></section><section id="dbg-run" class="section"><header><h3>run</h3></header><p>Continue running the pipeline.</p><div class="cmdsynopsis-wrap"><div class="cmdsynopsis"><span class="command">run</span></div></div><p>Starts running the pipeline again. Execution will continue until the next
breakpoint or until the pipeline finishes.</p><p>The command <code class="command">r</code> is a
synonym for <code class="command">run</code>.</p></section><section id="dbg-set" class="section"><header><h3>set</h3></header><p>Set the value of a step option of local variable.</p><div class="cmdsynopsis-wrap"><div class="cmdsynopsis"><span class="command">set</span> <span class="arg">$<em class="replaceable">varname</em></span> <span class="arg">=</span> <span class="arg"><em class="replaceable">expression</em></span></div></div><p>Changes the value of the stop option or local variable named
<code class="varname">$varname</code> to the value that results from
evaluating the expression. (If an error occurs evaluating the expression, the
empty sequence will be assigned.)</p><p>You can only set the values of options or variables that already exist. To create a
new variable, use <a href="#dbg-define" class="link">define</a>.</p></section><section id="dbg-show" class="section"><header><h3>show</h3></header><p>Show the results of evaluating an expression.</p><div class="cmdsynopsis-wrap"><div class="cmdsynopsis"><span class="command">show</span> <span class="arg"><em class="replaceable">expression</em></span></div></div><p>Evaluates the expression provided and displays the result.</p><p>The commands <code class="command">eval</code> and <code class="command">echo</code> are
synonyms for <code class="command">show</code>.</p></section><section id="dbg-stack" class="section"><header><h3>stack</h3></header><p>Display the stack.</p><div class="cmdsynopsis-wrap"><div class="cmdsynopsis"><span class="command">stack</span></div></div><p>Displays the current stack. The stack frame that is the
current context is marked with a <code class="literal">*</code>.
</p></section><section id="dbg-step" class="section"><header><h3>step</h3></header><p>Run the current step, the return to the debugger.</p><div class="cmdsynopsis-wrap"><div class="cmdsynopsis"><span class="command">step</span> <span class="cmdpunct">[</span><span class="arg">
   <span class="cmdpunct">[</span><span class="arg">to</span><span class="cmdpunct">]</span>
   <span class="arg"><em class="replaceable">end</em></span>
</span><span class="cmdpunct">]</span></div></div><p>Executes the current step, then returns to the debugger. (If a breakpoint
occurs before the next step, execution will stop at the breakpoint.)</p><p>If the “<code class="literal">end</code>” argument is given, the debugger will stop
at either the beginning of the next step or the end of the current step,
whichever comes first. If it stops at the end, the last stack frame is the step
that has just finished. You can inspect its options and inputs, but it has
already run, so changing them can have no effect.</p><p>The command <code class="command">s</code> is a synonym for
<code class="command">step</code>.</p></section><section id="dbg-subpipeline" class="section"><header><h3>subpipeline</h3></header><p>Show subpipeline steps.</p><div class="cmdsynopsis-wrap"><div class="cmdsynopsis"><span class="command">subpipeline</span></div></div><p>Displays the models that are children of the current (compound) step.</p><p>The command <code class="command">sub</code> is a synonym for
<code class="command">subpipeline</code>.</p></section><section id="dbg-up" class="section"><header><h3>up</h3></header><p>Move up in the stack.</p><div class="cmdsynopsis-wrap"><div class="cmdsynopsis"><span class="command">up</span> <span class="cmdpunct">[</span><span class="arg"><em class="replaceable">frames</em></span><span class="cmdpunct">]</span></div></div><p>Moves up <em class="replaceable">frames</em> stack frames, or one frame if
<em class="replaceable">frames</em> is not specified. Has no effect if you’re
already on the first frame.</p><p>The command <code class="command">u</code> is a synonym for
<code class="command">up</code>.</p></section></section><section id="debugger-example" class="section"><header><h2>Debugger example</h2></header><p>To explore how the debugger works, let’s work through a small example.
We’ll use the pipeline in <a href="graphs.html#debugger-pipeline" class="xref xref-figure">Figure <span class="label">3<span class="sep">.</span>2</span>, “The pipeline model”</a> from
<a href="graphs.html" class="xref xref-chapter">Chapter <span class="label">3</span>, Pipelines vs. Graphs</a>. It may be useful to refer to the graph
model, <a href="graphs.html#debugger-model" class="xref xref-figure">Figure <span class="label">3<span class="sep">.</span>3</span>, “The pipeline graph model”</a>, to see how the graphs
fit together.</p><p>There are three models, one for each pipeline and one for the compound
step. Let’s start running this pipeline under the debugger:</p><div class="pre-wrap screen-wrap"><pre class="screen verbatim verblines"><span class="line"><span class="ld"><code><span class="prompt">$ </span><span class="userinput">xmlcalabash debugger-example.xpl --debugger</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">Debugger at declare-step</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput"><span class="prompt">&gt; </span></span></code></span></span></pre></div><p>The message tells us that we’re at the start of the “main” pipeline and
the debugger is waiting for commands. We can look at the models with the
<code class="command">models</code>:</p><div class="pre-wrap screen-wrap"><pre class="screen verbatim verblines"><span class="line"><span class="ld"><code><span class="prompt">&gt; </span><span class="userinput">models</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">*pipeline   ... !declare-step</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput"> pipeline_2 ... !declare-step_2: ex:ident</span></code></span></span>
<span class="line"><span class="ld"><code><span class="prompt">&gt; </span><span class="userinput">models pipeline_2</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">identity ... p:identity !identity</span></code></span></span>
<span class="line"><span class="ld"><code><span class="prompt">&gt; </span><span class="userinput">models pipeline</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">document          ... cx:document !document</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">xinclude          ... p:xinclude !xinclude</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">ex1               ... ex:ident ex1</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">select_IC511      ... cx:select !select_IC511</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">for-each_pipeline ... S(p:for-each !for-each)</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">wrap-sequence     ... p:wrap-sequence !wrap-sequence</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">id2               ... p:identity id2</span></code></span></span>
<span class="line"><span class="ld"><code><span class="prompt">&gt; </span></code></span></span></pre></div><p>We can see that these models reflect the structure of the compiled pipelines.</p><p>Let’s look at the stack:</p><div class="pre-wrap screen-wrap"><pre class="screen verbatim verblines"><span class="line"><span class="ld"><code><span class="prompt">&gt; </span><span class="userinput">stack</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">*[0] !declare-step</span></code></span></span>
<span class="line"><span class="ld"><code><span class="prompt">&gt; </span><span class="userinput">step</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">Debugger at declare-step_head</span></code></span></span>
<span class="line"><span class="ld"><code><span class="prompt">&gt; </span><span class="userinput">step</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">Debugger at document</span></code></span></span>
<span class="line"><span class="ld"><code><span class="prompt">&gt; </span><span class="userinput">stack</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput"> [0] !declare-step</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">*[1] !document</span></code></span></span>
<span class="line"><span class="ld"><code><span class="prompt">&gt; </span></code></span></span></pre></div><p>The initial stack is just the one step, the main pipeline waiting to be run.
Stepping forward once takes us the head of the compound step. Stepping foward again
takes us to the <code class="tag tag-element">p:document</code> step. (Note that the order in which steps are run
depends on the connections between them, they are not displayed in any particular order
by the model or <code class="command">subpipeline</code> commands.)</p><p>We can explore the inputs to the step.</p><div class="pre-wrap screen-wrap"><pre class="screen verbatim verblines"><span class="line"><span class="ld"><code><span class="prompt">&gt; </span><span class="userinput">inputs</span></code></span></span>
<span class="line"><span class="ld"><code><span class="prompt">&gt; </span><span class="userinput">options</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">Step options:</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">  $href</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">  $document-properties</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">  $parameters</span></code></span></span>
<span class="line"><span class="ld"><code><span class="prompt">&gt; </span><span class="userinput">show $href</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">../xml/default-input.xml</span></code></span></span>
<span class="line"><span class="ld"><code><span class="prompt">&gt; </span></code></span></span></pre></div><p>The step has no inputs and three options. We can use the <code class="command">show</code>
command to inspect the values of the options. We could also use the <code class="command">set</code>
command to <em>change them</em>.</p><p>Let’s set a breakpoint on the <code class="tag tag-element">ex:ident</code> step:</p><div class="pre-wrap screen-wrap"><pre class="screen verbatim verblines"><span class="line"><span class="ld"><code><span class="prompt">&gt; </span><span class="userinput">up</span></code></span></span>
<span class="line"><span class="ld"><code><span class="prompt">&gt; </span><span class="userinput">stack</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">*[0] !declare-step</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput"> [1] !document</span></code></span></span>
<span class="line"><span class="ld"><code><span class="prompt">&gt; </span><span class="userinput">subpipeline</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">document       ... cx:document</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">xinclude       ... p:xinclude</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">declare-step_2 ... p:declare-step</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">select_IC511   ... cx:select</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">for-each       ... p:for-each</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">wrap-sequence  ... p:wrap-sequence</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">id2            ... p:identity</span></code></span></span>
<span class="line"><span class="ld"><code><span class="prompt">&gt; </span><span class="userinput">break on declare-step_2</span></code></span></span>
<span class="line"><span class="ld"><code><span class="prompt">&gt; </span></code></span></span></pre></div><p>We need the id of the <code class="tag tag-element">ex:ident</code> step. To find it, we navigate up
to the stack frame for the compound step, then we look at its <code class="command">subpipeline</code>.
The step we’re interested is the one named “<code class="literal">declare_step_2</code>.
Once we know its id, we can set a breakpoint on it.</p><div class="admonition note"><div><div class="icon">ⓘ</div><div class="body"><header><div class="title">Note</div></header><div><p>An obvious improvement here would be to allow the step type as the id
of the subpipeline in this case.</p></div></div></div></div><p>Using <code class="command">run</code>, we can advance to the breakpoint.</p><div class="pre-wrap screen-wrap"><pre class="screen verbatim verblines"><span class="line"><span class="ld"><code><span class="prompt">&gt; </span><span class="userinput">run</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">Debugger at declare-step_2</span></code></span></span>
<span class="line"><span class="ld"><code><span class="prompt">&gt; </span><span class="userinput">stack</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput"> [0] !declare-step</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">*[1] !declare-step_2</span></code></span></span>
<span class="line"><span class="ld"><code><span class="prompt">&gt; </span></code></span></span></pre></div><p>Now let’s do something more interesting. Let’s set a breakpoint on the output 
of the <code class="tag tag-element">p:add-attribute</code> step if there’s a role attribute on the output. You can
probably predict the id of the step, but it’s also possible to inspect the pipeline to
determine it. First, look at the current subpipeline to find the <code class="tag tag-element">p:for-each</code> step,
then look inside it for the <code class="tag tag-element">p:add-attribute-step</code>.</p><div class="pre-wrap screen-wrap"><pre class="screen verbatim verblines"><span class="line"><span class="ld"><code><span class="prompt">&gt; </span><span class="userinput">subpipeline</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">document       ... cx:document</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">xinclude       ... p:xinclude</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">declare-step_2 ... p:declare-step</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">select_IC511   ... cx:select</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">for-each       ... p:for-each</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">wrap-sequence  ... p:wrap-sequence</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">id2            ... p:identity</span></code></span></span>
<span class="line"><span class="ld"><code><span class="prompt">&gt; </span><span class="userinput">subpipeline for-each</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">for-each_head ... p:for-each</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">for-each_foot ... p:for-each</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">id1           ... p:identity</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">add           ... p:add-attribute</span></code></span></span>
<span class="line"><span class="ld"><code><span class="prompt">&gt; </span></code></span></span></pre></div><p>The id we want is “<code class="literal">add</code>”. Note that you can’t look “further down” into
the pipeline, even if there are nested compound steps.</p><p>Now we can set the breakpoint and run the pipeline.</p><div class="pre-wrap screen-wrap"><pre class="screen verbatim verblines"><span class="line"><span class="ld"><code><span class="prompt">&gt; </span><span class="userinput">break on add output result when //ex:chap[@role]</span></code></span></span>
<span class="line"><span class="ld"><code><span class="prompt">&gt; </span><code class="command">run</code></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">Output from add on result satisfies //ex:chap[@role]</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">Debugger at add</span></code></span></span>
<span class="line"><span class="ld"><code><span class="prompt">&gt; </span></code></span></span></pre></div><p>We can look at that document with <code class="command">show</code>:</p><div class="pre-wrap screen-wrap"><pre class="screen verbatim verblines"><span class="line"><span class="ld"><code><span class="prompt">&gt; </span><span class="userinput">show $cx:document</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">&lt;chap xmlns="https://xmlcalabash.com/ns/examples"</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">      xmlns:xi="http://www.w3.org/2001/XInclude"</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">      former="1"</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">      class="test"</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">      role="test"&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">   &lt;title&gt;First Chapter&lt;/title&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">   &lt;p&gt;…&lt;/p&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">&lt;/chap&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="prompt">&gt; </span></code></span></span></pre></div><p>The <code class="tag tag-element">p:add-attribute</code> step is in a loop. If we run again, we’ll stop
at the breakpoint the next time it occurs where we can see the second document:</p><div class="pre-wrap screen-wrap"><pre class="screen verbatim verblines"><span class="line"><span class="ld"><code><span class="prompt">&gt; </span><span class="userinput">run</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">Output from add on result satisfies //ex:chap[@role]</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">Debugger at add</span></code></span></span>
<span class="line"><span class="ld"><code><span class="prompt">&gt; </span><span class="userinput">show $cx:document</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">&lt;chap xmlns="https://xmlcalabash.com/ns/examples" role="test"&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">   &lt;title&gt;Second Chapter&lt;/title&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">   &lt;p&gt;…&lt;/p&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">&lt;/chap&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="prompt">&gt; </span></code></span></span></pre></div><p>For a last example, let’s be a little cheeky and change the output:</p><div class="pre-wrap screen-wrap"><pre class="screen verbatim verblines"><span class="line"><span class="ld"><code><span class="prompt">&gt; </span><span class="userinput">set $cx:document = parse-xml("&lt;change role='nothing to see here'/&gt;")</span></code></span></span>
<span class="line"><span class="ld"><code><span class="prompt">&gt; </span></code></span></span></pre></div><p>We’re not interested in stopping on that breakpoint again, so we can clear it.</p><div class="pre-wrap screen-wrap"><pre class="screen verbatim verblines"><span class="line"><span class="ld"><code><span class="prompt">&gt; </span><span class="userinput">break clear add</span></code></span></span>
<span class="line"><span class="ld"><code><span class="prompt">&gt; </span></code></span></span></pre></div><p>Now if we run again, we’ll get to the end of the pipeline.</p><div class="pre-wrap screen-wrap"><pre class="screen verbatim verblines"><span class="line"><span class="ld"><code><span class="prompt">&gt; </span><span class="userinput">run</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">=== result :: 1 :: file:/…/documentation/src/examples/xml/default-input.xml ===</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">&lt;set xmlns="https://xmlcalabash.com/ns/examples"&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">   &lt;chap xmlns:xi="http://www.w3.org/2001/XInclude"</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">         former="1"</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">         class="test"</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">         role="test"&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">      &lt;title&gt;First Chapter&lt;/title&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">      &lt;p&gt;…&lt;/p&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">   &lt;/chap&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">   &lt;change xmlns="" role="nothing to see here"/&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">   &lt;chap xmlns:xi="http://www.w3.org/2001/XInclude" role="test"&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">      &lt;title&gt;Third Chapter&lt;/title&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">      &lt;p&gt;…&lt;/p&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">   &lt;/chap&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">   &lt;app xmlns:xi="http://www.w3.org/2001/XInclude" role="test"&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">      &lt;title&gt;Appendix&lt;/title&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">      &lt;p&gt;…&lt;/p&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">   &lt;/app&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">&lt;/set&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="computeroutput">=================================================================================================================</span></code></span></span></pre></div><p>Note how the second chapter has been replaced by our change!</p><p>Hopefully, that gives you a flavor for what’s possible.</p></section></section></main><nav class="bottom"><table><tr><td class="previous"><a href="graphs.html">Prev</a></td><td class="up"><a href="index.html">Up</a></td><td class="next"><a href="assertions.html">Next</a></td></tr><tr><td class="previous">Chapter <span class="label">3</span><span class="sep">. </span>Pipelines vs. Graphs</td><td class="up"><a href="index.html">Home</a></td><td class="next">Chapter <span class="label">5</span><span class="sep">. </span>Schematron assertions</td></tr></table><nav class="tocopen"></nav><nav class="toc"></nav><!-- Hide ToC details from user agents that don’t support JS --><script type="text/html" class="tocopen"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAABDklEQVQ4je2UUW3EMAyGv0wDUAhlkDBIyuAYXCEclEJoGZRBUgYOgzJoGHgPW6o7rWq35+2TIkWW9duW7N+oKuM46jiOGGMAaNsW5xzee5xzn8EvRESXZUFEWNcVAFWl73v6vjcGUIAYIyEEANZ1RUSY55lSCo/HA4BhGGiahtvthnOOtm0BSCnRdd1eVAGNMeoR27aptVattbpt22FOjFGrzjsX1I7q/4q3y4xf8i/4FwT3Pcw5Y4zBWvujfQMopZBzJuf8XbCeVyWEgHOO+/2+x0SEaZpIKSEih0X2Wz6jdlxKuezaqL7qpZS0lLKbw/M4ANba3RyapiGE8OJGqOrpizGq916999VATvM/AGFn1sxsVjL5AAAAAElFTkSuQmCC" alt="[toc]"/></script><script type="text/html" class="toc"><header><span>Table of Contents</span><span class="close"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAtklEQVQ4jaWT0Q3DIAxEz52AEbyB2cDZhBEY3SNcPyqqBEwqpZaQAHNP5jBCEiJCPAiSIgAeiUe8zoveO9x9e9jd0XtfKwHA1hpHtNY49rO8u59zn4mqMiJSyFkcEVTVFQCAtdYFMotrrXN111JnyA/xCsggN2JeXmGEmaGU8l2XUmBm29fZuh0RW2PTK2SGZcamADPb3nmGmNkKOI7j1rAzJG2kcWhqkstQ1QX+/2ciKU/FJOUN6JFZYWpmK3sAAAAASUVORK5CYII=" alt="X"/></span><p class="ptoc-search"><input class="ptoc-search" placeholder="Search" style="width: 80%"/></p></header><div db-persistent-toc="persistent-toc.html" db-prefix="">Loading…</div></script></nav></body></html>